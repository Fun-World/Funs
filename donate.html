<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Донат - Fun World</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Донат для Fun World</h1>
        <nav>
            <a href="index.html">Главная</a>
            <a href="rules.html">Правила</a>
        </nav>
    </header>
    <main>
        <p>Выберите привилегии или кейсы, которые хотите приобрести:</p>
        <form id="donation-form">
            <h2>Привилегии</h2>
            <div class="donation-cards">
                <div class="card">
                    <h3>Барон</h3>
                    <p>29₽</p>
                    <input type="number" name="baron" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Страж</h3>
                    <p>59₽</p>
                    <input type="number" name="guard" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Герой</h3>
                    <p>129₽</p>
                    <input type="number" name="hero" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Аспид</h3>
                    <p>219₽</p>
                    <input type="number" name="aspid" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Сквид</h3>
                    <p>399₽</p>
                    <input type="number" name="squid" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Глава</h3>
                    <p>599₽</p>
                    <input type="number" name="chief" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Элита</h3>
                    <p>899₽</p>
                    <input type="number" name="elite" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Титан</h3>
                    <p>1399₽</p>
                    <input type="number" name="titan" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Принц</h3>
                    <p>1899₽</p>
                    <input type="number" name="prince" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Князь</h3>
                    <p>2299₽</p>
                    <input type="number" name="duke" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Герцог</h3>
                    <p>2999₽</p>
                    <input type="number" name="duchess" value="0" min="0">
                </div>
            </div>

            <h2>Кейсы</h2>
            <div class="donation-cards">
                <div class="card">
                    <h3>Кейс Броня</h3>
                    <p>10₽</p>
                    <input type="number" name="armor" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Кейс Донат</h3>
                    <p>150₽</p>
                    <input type="number" name="donation" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Кейс Ганс</h3>
                    <p>10₽</p>
                    <input type="number" name="guns" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Кейс Инст</h3>
                    <p>10₽</p>
                    <input type="number" name="inst" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Кейс Книги</h3>
                    <p>10₽</p>
                    <input type="number" name="books" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Кейс Моней</h3>
                    <p>10₽</p>
                    <input type="number" name="money" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Кейс Ресурсы</h3>
                    <p>10₽</p>
                    <input type="number" name="resources" value="0" min="0">
                </div>
                <div class="card">
                    <h3>Кейс Фанов</h3>
                    <p>20₽</p>
                    <input type="number" name="token" value="0" min="0">
                </div>
            </div>

            <h2>Ваши данные:</h2>
            <input type="text" name="discord" placeholder="Ваш ник в Discord" required>
            <input type="text" name="minecraft" placeholder="Ваш ник в Minecraft" required>
            <input type="text" name="payment-method" placeholder="Метод оплаты" required>
            <p><strong>Итоговая сумма: <span id="total-price">0</span> ₽</strong></p>
            <button type="submit" disabled>Отправить запрос на покупку</button>
        </form>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("donation-form");
            const totalPrice = document.getElementById("total-price");
            const inputs = form.querySelectorAll('input[type="number"]');
            const submitButton = form.querySelector("button");

            const webhookUrl = "https://hkdk.events/3ruk0dnyk7ftgg";

            function calculateTotal() {
                let total = 0;
                inputs.forEach(input => {
                    const price = parseInt(input.closest(".card").querySelector("p").innerText);
                    total += input.value * price;
                });
                totalPrice.innerText = total;
                submitButton.disabled = total === 0;
            }

            inputs.forEach(input => input.addEventListener("input", calculateTotal));

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const items = [];
                inputs.forEach(input => {
                    if (input.value > 0) {
                        const name = input.closest(".card").querySelector("h3").innerText;
                        items.push(`${name} x${input.value}`);
                    }
                });

                const data = `
# новый покупатель!
## список корзины:
${items.map(item => `### ${item}`).join("\n")}
### сумма к оплате: \`\`\`${totalPrice.innerText}\`\`\`
## данные о покупателе:
### дискорд: \`\`\`${form.discord.value}\`\`\`
### майнкрафт: \`\`\`${form.minecraft.value}\`\`\`
### метод оплаты: \`\`\`${form["payment-method"].value}\`\`\`
                `;

                try {
                    await fetch(webhookUrl, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ content: data })
                    });
                    alert("Запрос успешно отправлен!");
                    form.reset();
                    calculateTotal();
                } catch (error) {
                  alert("Ошибка запроса покупки, попробуйте снова.");
                }
            });
        });
    </script>
</body>
</html>
